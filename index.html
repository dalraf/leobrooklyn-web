<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Leo Brooklin Stories - Web</title>
    <link rel="icon" href="./favicon.png" />
    <link rel="manifest" href="/leobrooklyn-web/manifest.json">
    <link rel="apple-touch-icon" href="/leobrooklyn-web/icons/icon-192x192.png">
    <!-- Phaser 3 via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.min.js"></script>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        background: #000;
        height: 100%;
        overflow: hidden;
        touch-action: manipulation;
      }
      #game-container {
        position: relative;   /* permite overlay/HUD sobre o canvas */
        width: 100vw;
        height: max(100vh, -webkit-fill-available); /* Garante que o jogo ocupe a altura total disponível, considerando a barra de URL */
        overflow: hidden;
        padding-bottom: env(safe-area-inset-bottom); /* Adiciona padding para compensar a área segura inferior */
      }
      .hud {
        position: absolute;
        top: 0.75rem;
        left: 0.75rem;
        z-index: 10;
        pointer-events: none;
        user-select: none;

        display: inline-flex;
        align-items: center;
        gap: 10px;

        padding: 8px 12px;
        border-radius: 12px;
        background: linear-gradient(180deg, rgba(15,15,18,0.55), rgba(10,10,12,0.45));
        border: 1px solid rgba(255,255,255,0.12);
        box-shadow:
          0 4px 18px rgba(0,0,0,0.35),
          inset 0 0 0 1px rgba(255,255,255,0.06);
        backdrop-filter: blur(6px);

        color: #eaf2ff;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Segoe UI', Ubuntu, 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
        font-size: clamp(12px, 1.6vw, 16px);
        letter-spacing: 0.2px;
      }
      .hud .chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 8px;
        border-radius: 10px;
        background: rgba(255,255,255,0.06);
        border: 1px solid rgba(255,255,255,0.10);
        text-shadow: 0 1px 1px rgba(0,0,0,0.35);
      }
      .hud .icon {
        display: inline-block;
        width: 14px;
        height: 14px;
        border-radius: 3px;
        box-shadow: inset 0 0 0 1px rgba(255,255,255,0.35);
      }
      .hud .icon.score { background: linear-gradient(180deg, #3b82f6, #2563eb); }
      .hud .icon.life  { background: linear-gradient(180deg, #ef4444, #dc2626); }
      .hud .icon.rock  { background: linear-gradient(180deg, #f59e0b, #d97706); }

      .hud .label {
        opacity: 0.9;
      }
      .hud .value {
        font-variant-numeric: tabular-nums;
        font-weight: 700;
        color: #ffffff;
        text-shadow: 0 1px 2px rgba(0,0,0,0.4);
      }
      .overlay {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-family: sans-serif;
        flex-direction: column;
        gap: 12px;
        background: rgba(0,0,0,0.25);
        z-index: 20;
        padding: 16px;
        text-align: center;
      }
      .overlay button {
        pointer-events: auto;
        padding: 10px 16px;
        border-radius: 6px;
        border: none;
        background: #2d7ef7;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }
    /* --- Controles Touch --- */
    #touch-controls {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 30;
    }
    /* Joystick base e knob */
    .joystick {
      position: absolute;
      left: 16px;
      bottom: 16px;
      width: 180px;
      height: 180px;
      pointer-events: auto;
      touch-action: none;
    }
    .joy-base {
      position: absolute;
      left: 0; top: 0;
      width: 100%; height: 100%;
      border-radius: 50%;
      background: radial-gradient(ellipse at center, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
      border: 2px solid rgba(255,255,255,0.25);
      box-shadow: inset 0 0 12px rgba(0,0,0,0.45);
    }
    .joy-knob {
      position: absolute;
      left: 50%; top: 50%;
      width: 72px; height: 72px;
      margin-left: -36px; margin-top: -36px;
      border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, rgba(255,255,255,0.35), rgba(255,255,255,0.12));
      border: 2px solid rgba(255,255,255,0.45);
      box-shadow: 0 4px 12px rgba(0,0,0,0.45);
      transition: transform 60ms ease-out;
    }

    /* Remove D-Pad antigo visualmente se existir */
    #dpad { display: none !important; }

    /* Ações */
    #action-area {
      position: absolute;
      right: 16px;
      bottom: 16px;
      width: 220px;
      height: 160px;
      pointer-events: none;
    }
    .tc-btn {
      position: absolute;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(255,255,255,0.15);
      border: 2px solid rgba(255,255,255,0.35);
      pointer-events: auto;
      touch-action: none;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-family: monospace;
      user-select: none;
    }
    #btn-shoot {
      right: 16px; bottom: 16px;
      background: rgba(80,160,255,0.2); border-color: rgba(80,160,255,0.5);
    }
    #btn-attack {
      right: 112px; bottom: 48px;
      background: rgba(255,120,80,0.2); border-color: rgba(255,120,80,0.5);
    }

    @media (max-width: 420px) {
      .joystick { width: 160px; height: 160px; }
      .joy-knob { width: 64px; height: 64px; margin-left: -32px; margin-top: -32px; }
      .tc-btn { width: 68px; height: 68px; }
    }
    </style>
  </head>
  <body>
    <div id="game-container">
      <!-- Controles Touch sobre o canvas -->
      <div id="touch-controls" aria-hidden="false">
        <div class="joystick" id="joystick">
          <div class="joy-base"></div>
          <div class="joy-knob" id="joy-knob"></div>
        </div>
        <div id="action-area">
          <div id="btn-shoot" class="tc-btn" data-action="shoot">A</div>
          <div id="btn-attack" class="tc-btn" data-action="attack">B</div>
        </div>
      </div>
    </div>

    <div class="hud" id="hud">
      <span class="chip"><span class="icon score"></span><span class="label">Placar</span>: <span class="value" id="hudScore">0</span></span>
      <span class="chip"><span class="icon life"></span><span class="label">Vida</span>: <span class="value" id="hudLife">0</span></span>
      <span class="chip"><span class="icon rock"></span><span class="label">Pedras</span>: <span class="value" id="hudRocks">0</span></span>
    </div>

    <script type="module" src="./js/main.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/leobrooklyn-web/sw.js')
            .then((registration) => {
              console.log('Service Worker registrado com sucesso:', registration.scope);
            })
            .catch((error) => {
              console.error('Falha ao registrar o Service Worker:', error);
            });
        });
      }
    </script>
  </body>
</html>